(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{389:function(n,s,e){"use strict";e.r(s);var a=e(4),t=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h2",{attrs:{id:"error-sonarqube-server-xxxx-9000-can-not-be-reached"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#error-sonarqube-server-xxxx-9000-can-not-be-reached"}},[n._v("#")]),n._v(" ERROR: SonarQube server [xxxx:9000] can not be reached")]),n._v(" "),s("p",[s("strong",[n._v("一.描述")])]),n._v(" "),s("p",[n._v("  jenkins集成sonarqube时，出现以下错误：")]),n._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[n._v("INFO: Scanner configuration file: /usr/local/software/sonar-scanner/conf/sonar-scanner.properties\nINFO: Project root configuration file: NONE\nINFO: SonarScanner "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("4.8")]),n._v(".0.2856\nINFO: Java "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("11.0")]),n._v(".17 Eclipse Adoptium "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("64")]),n._v("-bit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\nINFO: Linux "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("3.10")]),n._v(".0-1160.88.1.el7.x86_64 amd64\nINFO: User cache: /var/lib/jenkins/.sonar/cache\nERROR: SonarQube server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("192.168")]),n._v(".56.101:9000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("]")]),n._v(" can not be reached\nINFO: ------------------------------------------------------------------------\nINFO: EXECUTION FAILURE\nINFO: ------------------------------------------------------------------------\nINFO: Total time: "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("0")]),n._v(".210s\nINFO: Final Memory: 3M/17M\nINFO: ------------------------------------------------------------------------\nERROR: Error during SonarScanner execution\norg.sonarsource.scanner.api.internal.ScannerException: Unable to execute SonarScanner analysis\n\tat org.sonarsource.scanner.api.internal.IsolatedLauncherFactory.lambda"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$createLauncher")]),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("IsolatedLauncherFactory.java:85"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat java.base/java.security.AccessController.doPrivileged"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Native Method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.IsolatedLauncherFactory.createLauncher"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("IsolatedLauncherFactory.java:74"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.IsolatedLauncherFactory.createLauncher"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("IsolatedLauncherFactory.java:70"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.EmbeddedScanner.doStart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("EmbeddedScanner.java:185"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.EmbeddedScanner.start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("EmbeddedScanner.java:123"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.cli.Main.execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Main.java:74"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.cli.Main.main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Main.java:62"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\nCaused by: java.lang.IllegalStateException: Fail to get bootstrap index from server\n\tat org.sonarsource.scanner.api.internal.BootstrapIndexDownloader.getIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("BootstrapIndexDownloader.java:42"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.JarDownloader.getScannerEngineFiles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("JarDownloader.java:58"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.JarDownloader.download"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("JarDownloader.java:53"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.IsolatedLauncherFactory.lambda"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$createLauncher")]),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("IsolatedLauncherFactory.java:76"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("..")]),n._v(". "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("7")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("more")]),n._v("\nCaused by: java.lang.IllegalArgumentException: Expected URL scheme "),s("span",{pre:!0,attrs:{class:"token string"}},[n._v("'http'")]),n._v(" or "),s("span",{pre:!0,attrs:{class:"token string"}},[n._v("'https'")]),n._v(" but no colon was found\n\tat org.sonarsource.scanner.api.internal.shaded.okhttp.HttpUrl"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$Builder")]),n._v(".parse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("HttpUrl.java:1332"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.shaded.okhttp.HttpUrl.get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("HttpUrl.java:917"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.shaded.okhttp.Request"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$Builder")]),n._v(".url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Request.java:165"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.ServerConnection.callUrl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ServerConnection.java:111"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.ServerConnection.downloadString"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ServerConnection.java:99"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonarsource.scanner.api.internal.BootstrapIndexDownloader.getIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("BootstrapIndexDownloader.java:39"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("..")]),n._v(". "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("10")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("more")]),n._v("\nERROR: \nERROR: Re-run SonarScanner using the "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[n._v("-X")]),n._v(" switch to "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("enable")]),n._v(" full debug logging.\nERROR: SonarQube scanner exited with non-zero code: "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v("\nSSH: Current build result is "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("[")]),n._v("FAILURE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("]")]),n._v(", not going to run.\nFinished: FAILURE\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br")])]),s("p",[s("strong",[n._v("二.分析及解决")])]),n._v(" "),s("p",[n._v("  日志提到："),s("code",[n._v("ERROR: SonarQube server [192.168.56.101:9000] can not be reached")]),n._v("，故检查jenkins中配置的sonarqube地址信息是否有问题，发现sonarqube的服务地址填写错误，如下图所示，少了前缀http://，应改为"),s("em",[n._v("http://192.168.156.101:9000")])]),n._v(" "),s("p",[s("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/hwj0123/BlogPictureRepository/blog/91e38130819d46a094d66ddb7509ce88_5BmGakdQ9v.png",alt:""}})]),n._v(" "),s("p",[s("strong",[n._v("三.参考")])]),n._v(" "),s("ul",[s("li",[n._v("https://www.reddit.com/r/devops/comments/rn2s4k/jenkins_server_unable_to_connect_to_sonarqube/")])]),n._v(" "),s("hr"),n._v(" "),s("h2",{attrs:{id:"java-lang-illegalstateexception-unrecoverable-indexation-failures-1-errors-among-1-requests"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-lang-illegalstateexception-unrecoverable-indexation-failures-1-errors-among-1-requests"}},[n._v("#")]),n._v(" java.lang.IllegalStateException: Unrecoverable indexation failures: 1 errors among 1 requests")]),n._v(" "),s("p",[s("strong",[n._v("一.描述")])]),n._v(" "),s("p",[n._v("  sonarqube以docker-compose方式运行，在jenkins集成sonarqube时，jenkins的任务输出框出现如下了错误：")]),n._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[n._v("java.lang.IllegalStateException: Unrecoverable indexation failures: "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v(" errors among "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v(" requests\n\tat org.sonar.server.es.IndexingListener"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$1")]),n._v(".onFinish"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("IndexingListener.java:39"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.server.es.BulkIndexer.stop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("BulkIndexer.java:131"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.server.measure.index.ProjectMeasuresIndexer.doIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ProjectMeasuresIndexer.java:162"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.server.measure.index.ProjectMeasuresIndexer.indexOnAnalysis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ProjectMeasuresIndexer.java:87"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.task.projectanalysis.step.IndexAnalysisStep.execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("IndexAnalysisStep.java:45"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.task.step.ComputationStepExecutor.executeStep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ComputationStepExecutor.java:81"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.task.step.ComputationStepExecutor.executeSteps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ComputationStepExecutor.java:72"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.task.step.ComputationStepExecutor.execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ComputationStepExecutor.java:59"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.task.projectanalysis.taskprocessor.ReportTaskProcessor.process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ReportTaskProcessor.java:81"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.taskprocessor.CeWorkerImpl"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$ExecuteTask")]),n._v(".executeTask"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("CeWorkerImpl.java:212"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.taskprocessor.CeWorkerImpl"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$ExecuteTask")]),n._v(".run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("CeWorkerImpl.java:194"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.taskprocessor.CeWorkerImpl.findAndProcessTask"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("CeWorkerImpl.java:160"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.taskprocessor.CeWorkerImpl"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$TrackRunningState")]),n._v(".get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("CeWorkerImpl.java:135"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.taskprocessor.CeWorkerImpl.call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("CeWorkerImpl.java:87"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat org.sonar.ce.taskprocessor.CeWorkerImpl.call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("CeWorkerImpl.java:53"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$TrustedFutureInterruptibleTask")]),n._v(".runInterruptibly"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("TrustedListenableFutureTask.java:125"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat com.google.common.util.concurrent.InterruptibleTask.run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("InterruptibleTask.java:69"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask.run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("TrustedListenableFutureTask.java:78"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat java.base/java.util.concurrent.Executors"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$RunnableAdapter")]),n._v(".call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Unknown Source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat java.base/java.util.concurrent.FutureTask.run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Unknown Source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$ScheduledFutureTask")]),n._v(".run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Unknown Source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Unknown Source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat java.base/java.util.concurrent.ThreadPoolExecutor"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$Worker")]),n._v(".run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Unknown Source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\tat java.base/java.lang.Thread.run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("Unknown Source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br")])]),s("p",[s("strong",[n._v("二.分析")])]),n._v(" "),s("p",[s("strong",[n._v("1、找到sonarqube的日志")])]),n._v(" "),s("p",[n._v("  为了找到sonarqube的日志，可以进入sonarqube对应的docker-compose.yml文件同级目录，然后执行"),s("code",[n._v("docker-compose logs -f")]),n._v("查看日志，也可以直接通过"),s("code",[n._v("docker logs -f “容器ID”")]),n._v("来查看对应sonarqube容器的日志输出，可通过"),s("code",[n._v("docker ps")]),n._v("来查看容器ID。")]),n._v(" "),s("p",[s("strong",[n._v("2、分析日志信息")])]),n._v(" "),s("p",[n._v("  查看snoarqube的日志后，发现上述问题是由于"),s("code",[n._v("Elasticsearch error: cluster_block_exception [FORBIDDEN/12/index read-only / allow delete (api)], flood stage disk watermark exceeded")]),n._v("引起，此外还有"),s("code",[n._v("flood stage disk watermark [95%] exceeded ... all indices on this node will marked read-only")]),n._v("的提示。")]),n._v(" "),s("p",[n._v("  基于上述日志信息来查阅资料，得到大致原因是："),s("strong",[n._v("sonarqube内部引用了Elasticsearch，而Elasticsearch设置了磁盘使用检查，会对磁盘空间进行监控，当磁盘剩余空间达到了 floodstage 阈值，会将所有相关索引强制置为只读")]),n._v("。")]),n._v(" "),s("p",[s("strong",[n._v("三.解决")])]),n._v(" "),s("p",[n._v("解决方法有以下3种，可依次尝试。")]),n._v(" "),s("p",[s("strong",[n._v("第一种：")])]),n._v(" "),s("p",[n._v("1.通过"),s("code",[n._v("docker exec -it “容器ID” bash")]),n._v("命令，可以进入sonarqube容器的bash命令行窗口，然后"),s("code",[n._v("cd /opt/sonarqube/data")]),n._v("。\n2.删除es7文件夹。")]),n._v(" "),s("p",[s("strong",[n._v("第二种：")])]),n._v(" "),s("p",[n._v("1.新建 elasticsearch.yml文件，文件内容为：")]),n._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[n._v("cluster.routing.allocation.disk.watermark.low: "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("90")]),n._v("%\ncluster.routing.allocation.disk.watermark.high: "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("95")]),n._v("%\ncluster.routing.allocation.disk.watermark.flood_stage: "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("99")]),n._v("%\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[n._v("这里通过上述可以调整elasticsearch对磁盘空间检查。")]),n._v(" "),s("p",[n._v("2.在sonarqube对应的docker-compose.yml中加入对elasticsearch.yml的映射")]),n._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[n._v("\nversion: "),s("span",{pre:!0,attrs:{class:"token string"}},[n._v("'3.1'")]),n._v("\nservices:\n  db:\n     image: postgres\n     container_name: db\n     ports:\n        - "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("5432")]),n._v(":5432\n     networks:\n        - sonarnet\n     environment:\n        POSTGRES_USER: sonar\n        POSTGRES_PASSWORD: sonar\n  sonarqube:\n     image: sonarqube:8.9.10-community\n     container_name: sonarqube\n     depends_on:\n        - db\n     ports:\n        - "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("9000")]),n._v(":9000\n     networks:\n        - sonarnet\n     environment:\n        - "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n._v("SONAR_JDBC_URL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v("jdbc:postgresql://db:5432/sonar\n        - "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n._v("SONAR_JDBC_USERNAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v("sonar\n        - "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n._v("SONAR_JDBC_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v("sonar\n     volumes:\n        - /usr/local/software/sonarquber/elasticsearch.yml:/opt/sonarqube/elasticsearch/config/elasticsearch.yml\nnetworks:\n  sonarnet:\n     driver: bridge\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br")])]),s("p",[n._v("  上面的/usr/local/software/sonarquber/elasticsearch.yml需要基于自己所建elasticsearch.yml所处目录进行修改。\n3.先执行"),s("code",[n._v("docker-compose down")]),n._v("，然后执行"),s("code",[n._v("docker-compose up -d")]),n._v("，即可重新部署sonarquber。")]),n._v(" "),s("p",[s("strong",[n._v("第三种：")])]),n._v(" "),s("p",[n._v("1.执行"),s("code",[n._v("df -Th")]),n._v("，查看虚拟机的磁盘使用情况\n这里发现系统根目录出现了空间不足的情况，比如："),s("code",[n._v("/dev/mapper/centos-root xfs 17G 14G 3.0G 82%")])]),n._v(" "),s("p",[n._v("2.对系统根目录进行扩容")]),n._v(" "),s("ul",[s("li",[s("p",[n._v("通过虚拟机软件新加一个物理磁盘，以vurtual box为例，为虚拟机新建一个新大小为80G的磁盘。")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/hwj0123/BlogPictureRepository/blog/8f09bbc3c2f94cacbeccf2401e0ec8ae.png",alt:""}})])]),n._v(" "),s("li",[s("p",[s("code",[n._v("ls /dev/sd*")]),n._v("，查看磁盘的编号，发现新建磁盘编号为/dev/sdb")])]),n._v(" "),s("li",[s("p",[s("code",[n._v("pvcreate /dev/sdb")])])]),n._v(" "),s("li",[s("p",[s("code",[n._v("vgs")])])]),n._v(" "),s("li",[s("p",[s("code",[n._v("vgextend centos /dev/sdb")])])]),n._v(" "),s("li",[s("p",[s("code",[n._v("lvextend -L +20G /dev/mapper/centos-root")])])]),n._v(" "),s("li",[s("p",[s("code",[n._v("xfs_growfs /dev/mapper/centos-root")])])])]),n._v(" "),s("p",[n._v("3.通过上述步骤发现已扩容成功")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/hwj0123/BlogPictureRepository/blog/c9b4663e48594f36ad7525f336f53161.png",alt:""}})]),n._v(" "),s("p",[s("strong",[n._v("四、引用")])]),n._v(" "),s("ul",[s("li",[n._v("https://stackoverflow.com/questions/50609417/elasticsearch-error-cluster-block-exception-forbidden-12-index-read-only-all?rq=2")]),n._v(" "),s("li",[n._v("https://stackoverflow.com/questions/74913401/sonarqube-unrecoverable-indexation-failures-1-errors-among-1-requests-check-el")]),n._v(" "),s("li",[n._v("https://www.jianshu.com/p/e1867d618351")]),n._v(" "),s("li",[n._v("https://www.cnblogs.com/feiyun126/p/7680534.html")])]),n._v(" "),s("hr"),n._v(" "),s("h2",{attrs:{id:"var-run-docker-sock-connect-permission-denied"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#var-run-docker-sock-connect-permission-denied"}},[n._v("#")]),n._v(" /var/run/docker.sock: connect: permission denied")]),n._v(" "),s("p",[s("strong",[n._v("一、问题描述")])]),n._v(" "),s("p",[n._v("在jenkins进行CI/CD时，需要调用宿主机上的docker来制作镜像，此时jenkins任务输出框出现了如下错误：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("ERROR: permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get \"http://%2Fvar%2Frun%2Fdocker.sock/_ping\": dial unix /var/run/docker.sock: connect: permission denied Build step 'Execute shell' marked build as failure\nSSH: Current build result is [FAILURE], not going to run.\nFinished: FAILURE\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[s("strong",[n._v("二、解决方法")])]),n._v(" "),s("p",[n._v("问题中指明了/uar/run/docker.sock文件无法访问，因此需要修改此文件的访问权限，这里使用root用户来修改文件权限，具体的步骤如下：")]),n._v(" "),s("ol",[s("li",[s("code",[n._v("cd /var/run")])]),n._v(" "),s("li",[n._v("执行"),s("code",[n._v("ll")]),n._v("发现，docker.sock文件访问权限为："),s("code",[n._v("srw-rw---- 1 root docker 0 May 10 08:40 docker.sock")])]),n._v(" "),s("li",[s("code",[n._v("chown root:root docker.sock")])]),n._v(" "),s("li",[s("code",[n._v("chmod o+rw docker.sock")])]),n._v(" "),s("li",[n._v("最终，docker.sock文件访问权限为："),s("code",[n._v("srw-rw-rw- 1 root root 0 May 10 08:40 docker.sock")])])]),n._v(" "),s("hr"),n._v(" "),s("h2",{attrs:{id:"测试statefulset资源时-pod卡死在containercreating"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试statefulset资源时-pod卡死在containercreating"}},[n._v("#")]),n._v(" 测试StatefulSet资源时，pod卡死在ContainerCreating")]),n._v(" "),s("p",[s("strong",[n._v("一、背景")])]),n._v(" "),s("p",[s("font",{attrs:{color:"#999AAA"}},[n._v("创建一个名为myapp的StatefulSet资源，通过Pod模板创建了3个Pod资源副本，并基于volumeClaimTemplates向前面创建的PV进行了请求大小为2Gi的专用存储卷。")])],1),n._v(" "),s("p",[s("strong",[n._v("二、问题描述")])]),n._v(" "),s("p",[n._v("没有像预计的那样创建三个pod副本，只创建了一个myapp-0副本，并且卡死在ContainerCreating状态。")]),n._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[n._v("NAME                           READY   STATUS              RESTARTS   AGE\nmyapp"),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("0")]),n._v("                        "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v("     ContainerCreating   "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("0")]),n._v("          "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("2")]),n._v("m57s\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[s("strong",[n._v("三、原因分析")])]),n._v(" "),s("p",[n._v("查看pv和pvc的情况如下，发现只有一个pv和pvc进行了绑定，并没有像预计的那样有三对绑定的pv和pvc。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("[root@k8sMaster volumes]# kubectl get pv\nNAME    CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                       STORAGECLASS   REASON   AGE\npv001   1Gi        RWO,RWX        Retain           Available                                                       14m\npv002   2Gi        RWO            Retain           Bound       default/myappdata-myapp-0                           14m\npv003   2Gi        RWO,RWX        Retain           Available                                                       14m\npv004   2Gi        RWO,RWX        Retain           Available                                                       14m\npv005   2Gi        RWO,RWX        Retain           Available                                                       14m\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("[root@k8sMaster volumes]# kubectl get pvc\nNAME                STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nmyappdata-myapp-0   Bound    pv002    2Gi        RWO                           13m\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])]),s("p",[s("strong",[n._v("四、解决方案")])]),n._v(" "),s("p",[n._v("通过kubectl describe pod myapp-0查看此pod的情况，如下：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('[root@k8sMaster volumes]# kubectl describe pod myapp-0\nName:           myapp-0\nNamespace:      default\nPriority:       0\nNode:           k8s-node2/192.168.139.145\nStart Time:     Tue, 16 Feb 2021 21:10:44 +0800\nLabels:         app=myapp-pod\n                controller-revision-hash=myapp-8598dd746f\n                statefulset.kubernetes.io/pod-name=myapp-0\nAnnotations:    <none>\nStatus:         Pending\nIP:             \nIPs:            <none>\nControlled By:  StatefulSet/myapp\nContainers:\n  myapp:\n    Container ID:   \n    Image:          ikubernetes/myapp:v1\n    Image ID:       \n    Port:           80/TCP\n    Host Port:      0/TCP\n    State:          Waiting\n      Reason:       ContainerCreating\n    Ready:          False\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /usr/share/nginx/html from myappdata (rw)\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dcwl2 (ro)\nConditions:\n  Type              Status\n  Initialized       True \n  Ready             False \n  ContainersReady   False \n  PodScheduled      True \nVolumes:\n  myappdata:\n    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)\n    ClaimName:  myappdata-myapp-0\n    ReadOnly:   false\n  default-token-dcwl2:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-dcwl2\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type     Reason       Age        From                Message\n  ----     ------       ----       ----                -------\n  Normal   Scheduled    <unknown>  default-scheduler   Successfully assigned default/myapp-0 to k8s-node2\n  Warning  FailedMount  12m        kubelet, k8s-node2  MountVolume.SetUp failed for volume "pv002" : mount failed: exit status 32\nMounting command: systemd-run\nMounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002 --scope -- mount -t nfs store:/data/volumes/v2 /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002\nOutput: Running scope as unit run-107550.scope.\nmount.nfs: Failed to resolve server store: Name or service not known\nmount.nfs: Operation already in progress\n  Warning  FailedMount  12m  kubelet, k8s-node2  MountVolume.SetUp failed for volume "pv002" : mount failed: exit status 32\nMounting command: systemd-run\nMounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002 --scope -- mount -t nfs store:/data/volumes/v2 /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002\nOutput: Running scope as unit run-107554.scope.\nmount.nfs: Failed to resolve server store: Name or service not known\nmount.nfs: Operation already in progress\n  Warning  FailedMount  11m  kubelet, k8s-node2  MountVolume.SetUp failed for volume "pv002" : mount failed: exit status 32\nMounting command: systemd-run\nMounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002 --scope -- mount -t nfs store:/data/volumes/v2 /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002\nOutput: Running scope as unit run-107577.scope.\nmount.nfs: Failed to resolve server store: Name or service not known\nmount.nfs: Operation already in progress\n  Warning  FailedMount  11m  kubelet, k8s-node2  MountVolume.SetUp failed for volume "pv002" : mount failed: exit status 32\nMounting command: systemd-run\nMounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002 --scope -- mount -t nfs store:/data/volumes/v2 /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002\nOutput: Running scope as unit run-107625.scope.\nmount.nfs: Failed to resolve server store: Name or service not known\nmount.nfs: Operation already in progress\n  Warning  FailedMount  11m  kubelet, k8s-node2  MountVolume.SetUp failed for volume "pv002" : mount failed: exit status 32\nMounting command: systemd-run\nMounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002 --scope -- mount -t nfs store:/data/volumes/v2 /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002\nOutput: Running scope as unit run-107642.scope.\nmount.nfs: Failed to resolve server store: Name or service not known\nmount.nfs: Operation already in progress\n  Warning  FailedMount  11m  kubelet, k8s-node2  MountVolume.SetUp failed for volume "pv002" : mount failed: exit status 32\nMounting command: systemd-run\nMounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002 --scope -- mount -t nfs store:/data/volumes/v2 /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002\nOutput: Running scope as unit run-107673.scope.\nmount.nfs: Failed to resolve server store: Name or service not known\nmount.nfs: Operation already in progress\n  Warning  FailedMount  11m  kubelet, k8s-node2  MountVolume.SetUp failed for volume "pv002" : mount failed: exit status 32\nMounting command: systemd-run\nMounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002 --scope -- mount -t nfs store:/data/volumes/v2 /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002\nOutput: Running scope as unit run-107771.scope.\nmount.nfs: Failed to resolve server store: Name or service not known\nmount.nfs: Operation already in progress\n  Warning  FailedMount  10m  kubelet, k8s-node2  MountVolume.SetUp failed for volume "pv002" : mount failed: exit status 32\nMounting command: systemd-run\nMounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002 --scope -- mount -t nfs store:/data/volumes/v2 /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002\nOutput: Running scope as unit run-107919.scope.\nmount.nfs: Failed to resolve server store: Name or service not known\nmount.nfs: Operation already in progress\n  Warning  FailedMount  9m58s                 kubelet, k8s-node2  Unable to attach or mount volumes: unmounted volumes=[myappdata], unattached volumes=[default-token-dcwl2 myappdata]: timed out waiting for the condition\n  Warning  FailedMount  104s (x6 over 9m53s)  kubelet, k8s-node2  (combined from similar events): MountVolume.SetUp failed for volume "pv002" : mount failed: exit status 32\nMounting command: systemd-run\nMounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002 --scope -- mount -t nfs store:/data/volumes/v2 /var/lib/kubelet/pods/e944e008-5137-40ac-b719-308810075492/volumes/kubernetes.io~nfs/pv002\nOutput: Running scope as unit run-110486.scope.\nmount.nfs: Failed to resolve server store: Name or service not known\nmount.nfs: Operation already in progress\n  Warning  FailedMount  52s (x3 over 5m24s)  kubelet, k8s-node2  Unable to attach or mount volumes: unmounted volumes=[myappdata], unattached volumes=[myappdata default-token-dcwl2]: timed out waiting for the condition\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br"),s("span",{staticClass:"line-number"},[n._v("97")]),s("br"),s("span",{staticClass:"line-number"},[n._v("98")]),s("br"),s("span",{staticClass:"line-number"},[n._v("99")]),s("br"),s("span",{staticClass:"line-number"},[n._v("100")]),s("br"),s("span",{staticClass:"line-number"},[n._v("101")]),s("br"),s("span",{staticClass:"line-number"},[n._v("102")]),s("br"),s("span",{staticClass:"line-number"},[n._v("103")]),s("br"),s("span",{staticClass:"line-number"},[n._v("104")]),s("br"),s("span",{staticClass:"line-number"},[n._v("105")]),s("br"),s("span",{staticClass:"line-number"},[n._v("106")]),s("br"),s("span",{staticClass:"line-number"},[n._v("107")]),s("br"),s("span",{staticClass:"line-number"},[n._v("108")]),s("br"),s("span",{staticClass:"line-number"},[n._v("109")]),s("br")])]),s("p",[n._v("发现问题描述在于"),s("code",[n._v("mount.nfs: Failed to resolve server store: Name or service not known mount.nfs: Operation already in progress Warning FailedMount 52s (x3 over 5m24s) kubelet, k8s-node2 Unable to attach or mount volumes: unmounted volumes=[myappdata], unattached volumes=[myappdata default-token-dcwl2]: timed out waiting for the condition")]),n._v("，大概意思是k8s-node2节点无法识别store（部署了nfs的主机名），因此无法挂载nfs卷。")]),n._v(" "),s("p",[n._v("查看k8s-node2节点的/etc/hosts配置，发现忘记配置了store的ip映射关系，故加上"),s("code",[n._v("store 192.168.139.189")]),n._v("，然后重新部署StatefulSet资源成功。\n结果如下：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("[root@k8sMaster statefulSetDemo]# kubectl get pod -owide\nNAME                           READY   STATUS    RESTARTS   AGE    IP            NODE        NOMINATED NODE   READINESS GATES\nmyapp-0                        1/1     Running   0          11s    10.244.1.27   k8s-node2   <none>           <none>\nmyapp-1                        1/1     Running   0          10s    10.244.0.17   k8s-node1   <none>           <none>\nmyapp-2                        1/1     Running   0          5s     10.244.1.28   k8s-node2   <none>           <none>\nmydemo01pod-694474c9bd-5pwlc   1/1     Running   0          2d6h   10.244.0.4    k8s-node1   <none>           <none>\nmydemo02pod-7cb5c8c875-vh9gv   1/1     Running   0          34h    10.244.0.9    k8s-node1   <none>           <none>\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("[root@k8sMaster statefulSetDemo]# kubectl get pv,pvc\nNAME                     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                       STORAGECLASS   REASON   AGE\npersistentvolume/pv001   1Gi        RWO,RWX        Retain           Available                                                       27m\npersistentvolume/pv002   2Gi        RWO            Retain           Bound       default/myappdata-myapp-0                           27m\npersistentvolume/pv003   2Gi        RWO,RWX        Retain           Bound       default/myappdata-myapp-1                           27m\npersistentvolume/pv004   2Gi        RWO,RWX        Retain           Bound       default/myappdata-myapp-2                           27m\npersistentvolume/pv005   2Gi        RWO,RWX        Retain           Available                                                       27m\n\nNAME                                      STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npersistentvolumeclaim/myappdata-myapp-0   Bound    pv002    2Gi        RWO                           26m\npersistentvolumeclaim/myappdata-myapp-1   Bound    pv003    2Gi        RWO,RWX                       26s\npersistentvolumeclaim/myappdata-myapp-2   Bound    pv004    2Gi        RWO,RWX                       21s\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br")])]),s("hr")])}),[],!1,null,null,null);s.default=t.exports}}]);